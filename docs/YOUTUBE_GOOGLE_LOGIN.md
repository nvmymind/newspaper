# 유튜브 구독 영상 – Google 로그인 설정

`/youtube` 페이지에서 Google 로그인 후 구독 채널의 최신 영상을 썸네일로 보려면 아래 설정이 필요합니다. **사설 기능과 무관**하며, 설정하지 않으면 유튜브 페이지에서만 로그인 버튼을 눌렀을 때 안내 메시지가 뜹니다.

---

## 1. Google Cloud Console 들어가기

1. 브라우저에서 **https://console.cloud.google.com/** 접속
2. **Google 계정으로 로그인** (이메일·비밀번호 입력)
3. 처음이면 "약관 동의" 등이 나올 수 있음 → **동의** 후 진행

---

## 2. 프로젝트 만들기(또는 선택)

1. 페이지 **맨 위**에 있는 **프로젝트 선택** 드롭다운 클릭 (제목 옆 "Google Cloud" 같은 곳)
2. **새 프로젝트** 클릭
   - 프로젝트 이름: 예) `newspaper-youtube` (아무 이름이나 가능)
   - **만들기** 클릭
3. 만들어진 프로젝트가 자동으로 선택됨. 위쪽에 프로젝트 이름이 보이면 OK

---

## 3. YouTube Data API v3 켜기

1. 왼쪽 **≡ (햄버거 메뉴)** 클릭
2. **API 및 서비스** → **라이브러리** 클릭
3. 검색창에 **YouTube Data API v3** 입력
4. **YouTube Data API v3** 카드 클릭
5. **사용** 버튼 클릭 → "API를 사용 설정했습니다" 나오면 완료

---

## 4. OAuth 동의 화면 설정 (한 번만)

1. 왼쪽 **≡** → **API 및 서비스** → **OAuth 동의 화면** 클릭
2. **외부** 선택 → **만들기** 클릭
3. **앱 정보** 입력:
   - 앱 이름: 예) `신문 사설 유튜브`
   - 사용자 지원 이메일: 본인 Gmail 선택
   - 개발자 연락처 이메일: 본인 Gmail 입력
4. **저장 후 계속** 클릭
5. **범위** 화면에서 **저장 후 계속** (추가 범위 안 넣어도 됨)
6. **테스트 사용자**에서 **+ 추가** 클릭 → 로그인에 사용할 **Gmail 주소** 입력(본인 계정 포함) → **저장 후 계속** → **대시보드로 돌아가기**  
   - ⚠️ 여기서 추가하지 않으면 나중에 "액세스 차단됨 / 인증 절차를 완료하지 않았습니다" 오류가 납니다.

---

## 5. OAuth 클라이언트 ID 만들기 (여기서 주소·비밀번호 받음)

1. 왼쪽 **≡** → **API 및 서비스** → **사용자 인증 정보** 클릭
2. 위쪽 **+ 사용자 인증 정보 만들기** 클릭
3. **OAuth 클라이언트 ID** 선택
4. **애플리케이션 유형**: **웹 애플리케이션** 선택
5. **이름**: 예) `newspaper-youtube` (아무 이름이나 가능)
6. **승인된 리디렉션 URI**에서 **+ URI 추가** 클릭 후, 아래를 **한 글자도 틀리지 않게** 입력:
   ```text
   http://127.0.0.1:8000/auth/google/callback
   ```
   - `https` 아님, `http` 로 입력
   - 끝에 `/` 없음
   - 포트 `8000` 그대로
7. **만들기** 클릭
8. **OAuth 클라이언트가 생성되었습니다** 창이 뜸:
   - **클라이언트 ID** (긴 글자) → 복사해서 메모장 등에 붙여넣기
   - **클라이언트 보안 비밀** → **복사** 클릭해서 메모장에 붙여넣기
9. **확인** 클릭해서 창 닫기

이제 **클라이언트 ID**와 **클라이언트 보안 비밀** 두 개를 가지고 있으면 됨.

## 6. 프로젝트 .env 설정

프로젝트 폴더 **`c:\newspaper`** 안에 **`.env`** 파일을 만듭니다. (이미 있으면 열기)

아래 세 줄을 넣되, **클라이언트 ID**와 **클라이언트 보안 비밀**은 5번에서 복사한 값으로 바꿉니다.

```env
GOOGLE_CLIENT_ID=여기에_5번에서_복사한_클라이언트_ID
GOOGLE_CLIENT_SECRET=여기에_5번에서_복사한_클라이언트_보안_비밀
SECRET_KEY=아무거나32자이상긴문자열
```

- `SECRET_KEY`: 아무 문장이나 32자 이상 (예: `my-secret-key-12345-long-enough`)

## 7. 서버 재시작

`.env`를 저장한 뒤 **uvicorn 서버를 한 번 종료했다가 다시 실행**해야 합니다.

```powershell
# Ctrl+C로 종료 후
uvicorn app.main:app --reload --host 127.0.0.1 --port 8000
```

시작 시 터미널에 `[유튜브] Google 로그인: 설정됨` 이 나오면 설정이 적용된 것입니다.

## 8. 동작 확인

1. 브라우저에서 **http://127.0.0.1:8000** 접속  
2. **유튜브 구독영상** 버튼 클릭 → `/youtube` 페이지(새 탭)  
3. **Google로 로그인** 클릭 → Google 로그인 화면으로 이동  
4. 계정 선택·권한 허용 후 `/youtube`로 돌아오면 구독 채널·최신 영상 썸네일이 **최신순**으로 표시  
5. **정렬** 드롭다운으로 최신순/오래된순 변경 가능  
6. 썸네일 클릭 시 해당 유튜브 영상 페이지로 이동

## 로그인 실패 시

- **"액세스 차단됨" / "인증 절차를 완료하지 않았습니다" (403 access_denied)**  
  → OAuth 앱이 **테스트 모드**라서, **테스트 사용자로 등록된 계정만** 로그인할 수 있습니다.  
  **Google Cloud Console** → **API 및 서비스** → **OAuth 동의 화면** → **테스트 사용자**에서 **+ 추가**로 로그인할 Gmail 주소를 넣고 저장하세요.
- **리디렉션 URI가 일치하지 않음**  
  Google 콘솔의 "승인된 리디렉션 URI"와 실제 사용 주소가 **완전히 같아야** 합니다.  
  - `http` vs `https`, 포트 번호, 끝의 `/` 유무까지 동일해야 함.
- **토큰 교환 실패**  
  서버 터미널에 `[유튜브] Google 토큰 교환 실패 ...` 로그가 나오면, 그 내용을 확인해 리디렉션 URI·클라이언트 비밀을 다시 점검하면 됩니다.
